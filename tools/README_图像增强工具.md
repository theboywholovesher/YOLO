# 图像增强工具使用说明

## 概述

这是一个功能强大的图像增强工具，支持多种图像增强方式，包括几何变换、颜色调整、滤镜效果等。工具提供了两种GUI界面：基础版本和高级版本，满足不同用户的需求。

**新增功能**: 自动标签文件处理，支持多种标注格式！**新增功能**: 标签文件输出目录选择和XML转YOLO格式转换！

## 功能特性

### 基础增强功能
- **几何变换**
  - 左右翻转
  - 上下翻转
  - 旋转90°、180°、270°
  
- **颜色调整**
  - 亮度增加/减少
  - 对比度增加/减少
  - 饱和度增加/减少
  
- **滤镜效果**
  - 模糊
  - 锐化
  - 添加噪声
  - 边缘增强
  - 浮雕效果
  - 查找边缘

### 高级功能
- **多格式标签支持**: 自动识别和处理XML、YOLO、COCO等标注格式
- **智能坐标变换**: 几何变换时自动更新边界框坐标
- **批量处理**: 支持整个文件夹的批量增强
- **参数调整**: 可调节增强效果的强度
- **实时预览**: 预览增强效果
- **设置保存**: 保存和恢复用户设置
- **标签文件输出目录选择**: 可以单独指定标签文件的保存位置
- **XML转YOLO工具**: 专门的格式转换工具，支持类别映射编辑

## 标签文件支持

### 支持的标注格式

#### 1. XML格式 (VOC)
- 文件扩展名: `.xml`
- 格式: 标准的VOC标注格式
- 特点: 包含类别名称、边界框坐标等完整信息

#### 2. YOLO格式
- 文件扩展名: `.txt`
- 格式: `class_id x_center y_center width height`
- 特点: 坐标归一化，适合YOLO训练

#### 3. COCO格式
- 文件扩展名: `.json`
- 格式: JSON格式的标注数据
- 特点: 支持复杂的标注信息

### 自动标签处理

工具会自动：
1. **检测标签格式**: 根据文件扩展名和内容自动识别格式
2. **查找对应文件**: 自动查找与图像同名的标签文件
3. **更新坐标**: 几何变换时自动更新边界框坐标
4. **生成新标签**: 为每个增强后的图像生成对应的标签文件
5. **自定义输出位置**: 可以单独指定标签文件的保存目录

### 坐标变换规则

- **翻转操作**: 自动调整边界框坐标
- **旋转操作**: 自动调整坐标并处理宽高变化
- **颜色调整**: 直接复制标签文件（无需坐标变换）

## XML转YOLO功能

### 主要特性
- **批量转换**: 支持整个文件夹的XML文件转换
- **自动类别映射**: 自动扫描并创建类别ID映射
- **手动编辑**: 支持手动编辑类别映射关系
- **类别映射文件**: 自动生成`classes.txt`文件
- **进度显示**: 实时显示转换进度

### 使用方法
1. 选择包含XML文件的输入目录
2. 选择YOLO格式输出目录
3. 扫描类别（自动创建类别映射）
4. 可选择编辑类别映射
5. 开始批量转换

### 输出文件
- **YOLO格式标签**: 每个XML文件对应一个`.txt`文件
- **类别映射文件**: `classes.txt`文件，记录类别ID和名称的对应关系

## 安装依赖

确保安装了以下Python包：

```bash
pip install pillow opencv-python numpy
```

## 使用方法

### 1. 启动工具

运行启动脚本：
```bash
python run_gui.py
```

启动器提供三个选项：
- **基础版本**: 简单易用的图像增强工具
- **高级版本**: 功能丰富的图像增强工具
- **XML转YOLO工具**: 专门的格式转换工具

或者直接运行特定版本：
```bash
# 基础版本
python image_augmentation_gui.py

# 高级版本
python advanced_image_augmentation_gui.py

# XML转YOLO工具
python xml_to_yolo_converter.py
```

### 2. 基础版本使用

1. **选择输入目录**: 点击"浏览"按钮选择包含图像的文件夹
2. **选择输出目录**: 选择保存增强后图像的文件夹
3. **选择标签输出目录**: （可选）选择标签文件的保存位置
4. **选择增强选项**: 勾选需要的增强方式
5. **开始处理**: 点击"开始处理"按钮
6. **工具功能**: 使用"XML转YOLO"和"查看类别映射"按钮

### 3. 高级版本使用

1. **文件选择**: 选择输入、输出和标签输出目录
2. **增强选项**: 选择增强方式，可调整参数
3. **预览效果**: 点击"预览效果"查看增强结果
4. **开始处理**: 执行批量增强
5. **保存设置**: 保存当前配置供下次使用
6. **工具功能**: 使用"XML转YOLO"和"查看类别映射"按钮

### 4. XML转YOLO工具使用

1. **选择输入目录**: 选择包含XML文件的目录
2. **选择输出目录**: 选择YOLO格式输出目录
3. **扫描类别**: 自动扫描并创建类别映射
4. **编辑映射**: （可选）手动编辑类别映射
5. **开始转换**: 执行批量格式转换

## 文件结构

```
tools/
├── strange_img.py                    # 核心增强函数和标签处理
├── image_augmentation_gui.py         # 基础GUI界面
├── advanced_image_augmentation_gui.py # 高级GUI界面
├── xml_to_yolo_converter.py          # XML转YOLO专用工具
├── run_gui.py                       # 启动器
├── test_label_processing.py          # 标签处理功能测试
├── build_exe.py                     # 打包脚本
├── requirements.txt                  # 依赖包列表
└── README_图像增强工具.md            # 使用说明
```

## 增强选项说明

### 几何变换
- **左右翻转**: 水平镜像翻转图像
- **上下翻转**: 垂直镜像翻转图像
- **旋转**: 按指定角度旋转图像

### 颜色调整
- **亮度**: 调整图像整体明暗程度
- **对比度**: 调整图像明暗对比
- **饱和度**: 调整图像色彩鲜艳程度

### 滤镜效果
- **模糊**: 使用高斯模糊柔化图像
- **锐化**: 增强图像边缘和细节
- **噪声**: 添加随机噪声增加真实感
- **边缘增强**: 突出图像边缘特征
- **浮雕**: 创建3D浮雕效果
- **边缘检测**: 提取图像边缘轮廓

## 参数调整

高级版本支持调整以下参数：

- **亮度因子**: 0.1-5.0 (1.0为原始亮度)
- **对比度因子**: 0.1-5.0 (1.0为原始对比度)
- **饱和度因子**: 0.1-5.0 (1.0为原始饱和度)
- **模糊半径**: 0-10 (数值越大越模糊)
- **锐化因子**: 0.1-5.0 (数值越大越锐利)
- **噪声因子**: 0.01-1.0 (数值越大噪声越明显)

## 标签文件处理

### 自动检测和匹配

工具会自动：
1. 扫描输入目录中的图像文件
2. 查找对应的标签文件（同名不同扩展名）
3. 检测标签文件格式
4. 根据增强类型决定是否需要坐标变换

### 输出文件命名

增强后的文件会自动添加后缀：
- `image_flip_h.jpg` + `image_flip_h.xml` (左右翻转)
- `image_rot90.jpg` + `image_rot90.txt` (旋转90°)
- `image_bright_up.jpg` + `image_bright_up.xml` (亮度增加)

### 坐标变换示例

**原始图像**: 800x600，边界框 [100, 200, 300, 400]

**左右翻转后**:
- 图像: 800x600
- 边界框: [500, 200, 700, 400] (x坐标翻转)

**旋转90°后**:
- 图像: 600x800 (宽高互换)
- 边界框: [200, 500, 400, 700] (坐标转换)

## 批量处理

1. 将需要增强的图像放在同一文件夹中
2. 如果有对应的标签文件，确保文件名一致
3. 选择增强选项和参数
4. 选择标签文件输出目录（可选）
5. 执行批量处理

## 测试标签处理功能

运行测试脚本验证标签处理功能：

```bash
python test_label_processing.py
```

测试内容包括：
- 标签格式检测
- XML/YOLO解析
- 坐标变换计算
- 标签文件生成

## 注意事项

1. **内存使用**: 处理大量图像时注意内存使用情况
2. **文件格式**: 支持常见图像格式：JPG、PNG、BMP、TIFF
3. **标签文件**: 支持XML、YOLO、COCO格式
4. **文件命名**: 图像和标签文件必须同名（扩展名可不同）
5. **输出命名**: 增强后的文件会自动添加后缀标识
6. **标签输出目录**: 如果指定了标签输出目录，标签文件将保存到指定位置
7. **类别映射**: XML转YOLO时会自动创建类别映射，也可手动编辑

## 故障排除

### 常见问题

1. **导入错误**: 检查是否安装了所需的依赖包
2. **内存不足**: 减少同时处理的图像数量
3. **文件权限**: 确保有读写目标文件夹的权限
4. **格式不支持**: 检查图像文件格式是否受支持
5. **标签文件未找到**: 检查标签文件是否与图像同名
6. **类别映射错误**: 检查XML文件中的类别名称是否一致

### 错误信息

- "图像路径不存在": 检查输入目录路径是否正确
- "标签文件未找到": 检查标签文件是否存在且命名正确
- "处理失败": 查看控制台输出的详细错误信息
- "坐标转换失败": 检查标签文件格式是否正确
- "类别映射失败": 检查XML文件中的标注信息

## 更新日志

- **v1.0**: 基础图像增强功能
- **v1.1**: 添加XML标注支持
- **v1.2**: 增加高级GUI界面
- **v1.3**: 添加参数调整和预览功能
- **v2.0**: 新增多格式标签文件支持，自动坐标变换
- **v2.1**: 新增标签文件输出目录选择功能
- **v2.2**: 新增XML转YOLO格式转换工具

## 技术支持

如有问题或建议，请检查：
1. Python版本兼容性
2. 依赖包版本
3. 文件路径和权限
4. 控制台错误信息
5. 标签文件格式是否正确
6. 类别映射是否一致

## 许可证

本工具仅供学习和研究使用。
